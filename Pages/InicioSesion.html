<!doctype html>
<html lang="es" data-bs-theme="dark">

<head>
  <meta charset="utf-8">
  <title>PokeMarket - Iniciar sesión</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <!-- CSS compartido PokeMarket -->
  <link rel="stylesheet" href="../CSS/style.css">
</head>

<body>

  <div class="bg-pokeballs d-flex flex-column min-vh-100">

    <!-- NAVBAR PokeMarket -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2 mb-0" href="../Home.html">
          <img src="../img/Masterball.png" alt="Masterball" width="32" height="32">
          <span class="fw-semibold">PokeMarket</span>
        </a>
      </div>
    </nav>

    <!-- CARD LOGIN CENTRADA -->
    <div class="container flex-grow-1 d-flex justify-content-center align-items-center py-5">
      <div class="card shadow-lg" style="max-width: 420px; width: 100%;">

        <!-- Logo + nombre -->
        <div class="card-header text-center bg-transparent border-0 pt-4">
          <img src="../img/Masterball.png" alt="Masterball" width="56" height="56" class="mb-2">
          <h4 class="fw-bold mb-0">PokeMarket</h4>
        </div>

        <div class="card-body pt-3">
          <h5 class="text-center mb-4">Iniciar sesión</h5>

          <form id="formLogin" class="needs-validation" novalidate>
            
            <!-- Usuario o correo -->
            <div class="mb-3">
              <label for="userOrEmail" class="form-label">Nombre de usuario o correo electrónico</label>
              <div class="input-group">
                <span class="input-group-text">
                  <i class="bi bi-person-circle"></i>
                </span>
                <input type="text" class="form-control" id="userOrEmail" name="userOrEmail" required autofocus
                  aria-describedby="userHelp">
              </div>
              <div id="userHelp" class="form-text small">
                Puedes usar tu nombre de usuario o tu correo.
              </div>
              <div class="invalid-feedback">
                Introduce tu nombre de usuario o correo electrónico.
              </div>
            </div>

            <!-- Contraseña -->
            <div class="mb-3">
              <label for="loginPassword" class="form-label">Contraseña</label>
              <div class="input-group">
                <span class="input-group-text">
                  <i class="bi bi-shield-lock-fill"></i>
                </span>
                <input type="password" class="form-control" id="loginPassword" name="loginPassword" required
                  aria-describedby="loginPassHelp">
                <button class="btn btn-outline-secondary" type="button" id="toggleLoginPass"
                  aria-label="Mostrar u ocultar contraseña">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              <div id="loginPassHelp" class="form-text small">
                Mantén tu cuenta segura. No compartas tu contraseña.
              </div>
              <div class="invalid-feedback">
                Introduce tu contraseña.
              </div>
            </div>

            <!-- Problemas para iniciar sesión -->
            <div class="mb-3 text-center">
              <a href="#" class="small text-decoration-none">
                ¿Tienes problemas para iniciar sesión?
              </a>
            </div>

            <!-- Botón iniciar sesión -->
            <div class="d-grid mb-3">
              <button type="submit" class="btn btn-warning fw-semibold rounded-pill py-2">
                Iniciar sesión
              </button>
            </div>

            <!-- Separador -->
            <div class="d-flex align-items-center mb-3">
              <hr class="flex-grow-1 my-0">
              <span class="px-3 small text-muted">o</span>
              <hr class="flex-grow-1 my-0">
            </div>

            <!-- Botón Google -->
            <div class="d-grid mb-4">
              <button type="button" class="btn btn-google d-flex align-items-center justify-content-center gap-2 py-2" 
                      id="googleSignInBtn">
                <i class="bi bi-google"></i>
                Continuar con Google
              </button>
            </div>

            <!-- Crear cuenta -->
            <div class="text-center pb-3">
              <p class="mb-2 small">¿No tienes cuenta?</p>
              <a href="Registro.html" class="btn btn-warning btn-sm fw-semibold rounded-pill px-4">
                Crear cuenta
              </a>
            </div>

          </form>
        </div>
      </div>
    </div>

  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (() => {
      'use strict';

      const form = document.getElementById('formLogin');
      const pass = document.getElementById('loginPassword');
      const togglePass = document.getElementById('toggleLoginPass');
      const googleBtn = document.getElementById('googleSignInBtn');

      function togglePassword(input, button) {
        const icon = button.querySelector('i');
        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('bi-eye');
          icon.classList.add('bi-eye-slash');
        } else {
          input.type = 'password';
          icon.classList.remove('bi-eye-slash');
          icon.classList.add('bi-eye');
        }
      }

      togglePass.addEventListener('click', () => togglePassword(pass, togglePass));

      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
          form.classList.add('was-validated');
          return;
        }

        event.preventDefault();
        form.classList.remove('was-validated');

        const userOrEmail = document.getElementById('userOrEmail').value;
        const password = document.getElementById('loginPassword').value;

        localStorage.setItem('pm_user_name', userOrEmail.split('@')[0] || 'Entrenador');
        localStorage.setItem('pm_user_email', userOrEmail.includes('@') ? userOrEmail : userOrEmail + '@gmail.com');
        localStorage.setItem('pm_user_avatar', '../img/avatars/pokeball.png');

        window.location.href = '../index.html';
      });

      googleBtn.addEventListener('click', () => {
        alert('Aquí iría el selector real de cuentas de Google (requiere API de Google).');
      });
    })();
  </script>

</body>
</html>
